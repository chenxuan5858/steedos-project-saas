name: contracts
label: Contracts
icon: contract
enable_files: true
enable_search: true
enable_events: true
enable_tasks: true
enable_api: true
enable_chatter: true
enable_audit: true
fields:
  name:
    label: Contract Name
    type: text
    required: true
    searchable: true
    index: true
  no:
    type: autonumber
    formula: "{YYYY}-{000}"
    label: Contract Number
    sortable: true
    filterable: true
    omit: true
    readonly: true
  othercompany:
    type: lookup
    relatedList: true
    label: Accounts
    searchable: true
    reference_to: accounts
    required: true
  contract_type:
    type: lookup
    label: Contract Type
    reference_to: contract_types
    required: true
  create_date:
    label: Create Date
    type: date
    sortable: true
    filterable: true
    defaultValue: "{now}"
  bop:
    type: select
    label: Type
    options:
      - label: 付款合同
        value: payment contract
      - label: 收款合同
        value: collection contract
    allowedValues:
      - payment contract
      - collection contract
    required: true
    defaultValue: collection contract
  owner:
    label: Owner
    sortable: true
    type: lookup
    reference_to: users
    omit: false
    hidden: false
  created_by:
    label: Created By
    sortable: true
    type: lookup
    reference_to: users
  modified_by:
    label: Modified By
    sortable: true
    type: lookup
    reference_to: users
  subject:
    type: textarea
    label: Main Contents
    is_wide: true
  amount:
    label: Contract Amount
    type: number
    scale: 2
    required: true
    sortable: true
  signed_date:
    label: Signed Date
    type: date
    sortable: true
    filterable: true
  start_date:
    label: Start Date
    type: date
    sortable: true
    filterable: true
  end_date:
    label: End Date
    type: date
    sortable: true
    filterable: true
  remark:
    label: Remark
    type: textarea
    is_wide: true
  instance_state:
    type: select
    label: Contract Status
    searchable: true
    options:
      - label: 审批中
        value: pending
      - label: 已核准
        value: approved
      - label: 已驳回
        value: rejected
      - label: 已取消
        value: terminated
      - label: 已签订
        value: signed
      - label: 已作废
        value: droped
      - label: 已完成
        value: completed
    omit: false
    hidden: false
  contract_fulfillment_state:
    type: select
    label: Contract Fulfillment Status
    searchable: true
    options:
      - label: 履行中
        value: fulfilling
      - label: 履行完
        value: fulfillment
      - label: 已取消
        value: terminated
  paid_amount:
    label: Total Amount Paid
    type: number
    scale: 2
    sortable: true
    readonly: true
    defaultValue: 0
  unpaid_amount:
    label: Total Amount Unpaid
    type: number
    scale: 2
    sortable: true
    readonly: true
    defaultValue: 0
  received_amount:
    label: Total Amount Received
    type: number
    scale: 2
    sortable: true
    readonly: true
    defaultValue: 0
  unreceived_amount:
    label: Total Amount Unreceived
    type: number
    scale: 2
    sortable: true
    readonly: true
    defaultValue: 0
list_views:
  all:
    label: All Valid Contracts
    filters: !<tag:yaml.org,2002:js/function> |-
      function () {
          return [
            ["instance_state","<>","terminated"], "and",["instance_state","<>","pending"], "and",["instance_state","<>","rejected"], "and",["instance_state","<>","droped"]
          ];
      }
    columns:
      - field: create_date
        width: 150
        wrap: true
      - field: name
        width: 280
        wrap: true
      - field: othercompany
        width: 200
      - field: amount
        width: 120
      - field: contract_type
        width: 120
      - field: bop
        width: 120
      - field: owner
        width: 120
      - field: signed_date
        width: 150
      - field: start_date
        width: 150
      - field: end_date
        width: 150
    filter_scope: space
    filter_fields:
      - contract_type
      - signed_date
      - othercompany
      - instance_state
    sort:
      - - create_date
        - desc
  recent:
    label: Recently Viewed
    filter_scope: space
    filters: !<tag:yaml.org,2002:js/function> |-
      function () {
          return [
            ["instance_state","<>","terminated"]
          ];
      }
    filter_fields:
      - contract_type
      - signed_date
      - othercompany
      - instance_state
    sort:
      - - create_date
        - desc
  mine:
    label: My Valid Contracts
    filter_scope: mine
    filters: !<tag:yaml.org,2002:js/function> |-
      function () {
          return [
            ["instance_state","<>","terminated"], "and",["instance_state","<>","pending"], "and",["instance_state","<>","rejected"], "and",["instance_state","<>","droped"]
          ];
      }
    filter_fields:
      - contract_type
      - signed_date
      - othercompany
      - instance_state
    sort:
      - - create_date
        - desc
  mine_invalid:
    label: My Other Contracts
    filter_scope: mine
    filters: !<tag:yaml.org,2002:js/function> |-
      function () {
          return [
            ["instance_state","=","terminated"], "or",["instance_state","=","rejected"], "or",["instance_state","=","droped"]
          ];
      }
    columns:
      - field: create_date
        width: 150
        wrap: true
      - field: name
        width: 280
        wrap: true
      - field: instance_state
        width: 120
        wrap: true
      - field: othercompany
        width: 200
      - field: amount
        width: 120
      - field: contract_type
        width: 120
      - field: bop
        width: 120
      - field: owner
        width: 120
    filter_fields:
      - contract_type
      - signed_date
      - othercompany
      - instance_state
    sort:
      - - create_date
        - desc
  contract_payments:
    label: Payment Contract
    filter_scope: space
    filters: !<tag:yaml.org,2002:js/function> |-
      function () {
          return [
            ["bop","=","payment contract"],
            ["instance_state","<>","terminated"], "and",["instance_state","<>","pending"], "and",["instance_state","<>","rejected"], "and",["instance_state","<>","droped"]
          ];
      }
    columns:
      - field: create_date
        width: 150
      - field: "no"
        width: 150
        wrap: true
      - field: name
        width: 220
        wrap: true
      - field: instance_state
        width: 120
        wrap: true
      - field: othercompany
        width: 220
        wrap: true
      - field: amount
        width: 120
        wrap: true
      - field: unfor_invoicing_amount
        width: 120
        wrap: true
      - field: unpaid_amount
        width: 120
        wrap: true
      - field: for_invoicing_amount
        width: 120
        wrap: true
      - field: paid_amount
        width: 120
        wrap: true
      - field: owner
        width: 120
        wrap: true
    filter_fields:
      - contract_type
      - signed_date
      - othercompany
      - instance_state
    sort:
      - - create_date
        - desc
  contract_receipts:
    label: Collection Contract
    filter_scope: space
    filters: !<tag:yaml.org,2002:js/function> |-
      function () {
          return [
            ["bop","=","collection contract"],
            ["instance_state","<>","terminated"], "and",["instance_state","<>","pending"], "and",["instance_state","<>","rejected"], "and",["instance_state","<>","droped"]
          ];
      }
    columns:
      - field: create_date
        width: 150
      - field: "no"
        width: 150
        wrap: true
      - field: name
        width: 220
        wrap: true
      - field: instance_state
        width: 120
        wrap: true
      - field: othercompany
        width: 220
        wrap: true
      - field: amount
        width: 120
        wrap: true
      - field: unfor_invoicing_amount
        width: 120
        wrap: true
      - field: unreceived_amount
        width: 120
        wrap: true
      - field: for_invoicing_amount
        width: 120
        wrap: true
      - field: received_amount
        width: 120
        wrap: true
      - field: owner
        width: 120
        wrap: true
    filter_fields:
      - contract_type
      - signed_date
      - othercompany
      - instance_state
    sort:
      - - create_date
        - desc
  all_pending:
    label: All Pending Contracts
    filter_scope: space
    filters: !<tag:yaml.org,2002:js/function> |-
      function () {
          return [
            ["instance_state","=","pending"]
          ];
      }
    columns:
      - field: create_date
        width: 150
        wrap: true
      - field: name
        width: 280
        wrap: true
      - field: instance_state
        width: 120
        wrap: true
      - field: othercompany
        width: 200
      - field: amount
        width: 120
      - field: contract_type
        width: 120
      - field: bop
        width: 120
      - field: owner
        width: 120
    filter_fields:
      - contract_type
      - signed_date
      - othercompany
      - instance_state
    sort:
      - - create_date
        - desc
  all_invalid:
    label: All Invalid Contracts
    filter_scope: space
    filters: !<tag:yaml.org,2002:js/function> |-
      function () {
          return [
            ["instance_state","=","terminated"], "or",["instance_state","=","rejected"], "or",["instance_state","=","droped"]
          ];
      }
    columns:
      - field: create_date
        width: 150
        wrap: true
      - field: name
        width: 280
        wrap: true
      - field: instance_state
        width: 120
        wrap: true
      - field: othercompany
        width: 200
      - field: amount
        width: 120
      - field: contract_type
        width: 120
      - field: bop
        width: 120
      - field: owner
        width: 120
    filter_fields:
      - contract_type
      - signed_date
      - othercompany
      - instance_state
    sort:
      - - create_date
        - desc

permission_set:
  user:
    allowCreate: true
    allowDelete: true
    allowEdit: true
    allowRead: true
    modifyAllRecords: false
    viewAllRecords: false 
  contract_manager:
    allowCreate: true
    allowEdit: true
    allowDelete: true
    allowRead: true
    modifyAllRecords: true
    viewAllRecords: true
  admin:
    allowCreate: true
    allowDelete: true
    allowEdit: true
    allowRead: true
    modifyAllRecords: true
    viewAllRecords: true